---
utid: 20110504150537
title: کلاس تاریخ جلالی برای php
_index: jdatetime
_permalink: /projects/:title/
_type: page
_layout: custom
---
سالها بود برای تبدیل تاریخ میلادی به جلالی در پروژه‌ها از تابع تاریخ شمسی که توسط دوست خوبم میلاد راستیان نوشته شده بود استفاده می‌کردم و این تابع با وجود قدیمی بودنش به خوبی از پس همه کارها بر می‌آمد. تا شب پیش که درحال کار کردن روی سیستمی بودم که نیاز به محاسبی زمانی برای سالهای بسیار دور داشت (مثلا ۱۰۰ سال آینده). با کمی تست متوجه شدم که تابع [date](http://php.net/date) که تابع پیشفرض پی‌اچ‌پی برای تاریخ و زمان است، حداکثر تا سال ۲۰۳۸ میلادی قادر به محاسبه است. به همین دلیل تابع تاریخ شمسی قبلی که از آن استفاده می‌کردم، بخاطر اینکه بر اساس تابع date نوشته شده بود، قادر به محاسبه سال‌های بیشتر از ۱۴۱۵ شمسی نبود. بعد از اینکه مطمئن شدم این تابع قابل تصحیح نیست، تصمیم گرفتم بر اساس امکان جدیدی که در PHP5 معرفی شده بود به نام DateTime یک کلاس تاریخ جلالی بنویسم که امکاناتی که برای پروژه خودم مد نظر بود را داشته باشد. گفتنی است که کلاس DateTime در پی‌اچ‌پی قادر است تا سال ۹۹۹۹ میلادی را محاسبه کند.

## امکانات کلاس تاریخ جلالی (نسخه ۲)

* قالب بندی زمان بر اساس تمام پارامترهای موجود در [تابع date پی‌اچ‌پی](http://php.net/date)
* قالب بندی زمان بر اساس تمام پارامترهای موجود در [تابع strftime پی‌اچ‌پی](http://php.net/strftime) (جدید)
* امکان فعال/غیرفعال کردن تبدیل تاریخ به جلالی
* امکان فعال/غیرفعال کردن تبدیل اعداد به فارسی
* امکان استفاده از [مناطق زمانی تعریف شده در پی‌اچ‌پی](http://www.php.net/manual/en/timezones.php)، برای مثال: `Asia/Tehran`
* امکان ساخت زمان از نوع Unix Timestamp یا Epoch Time
* نوشته شده به صورت شی‌گرا.
* امکان استفاده به صورت Static (جدید)

## نحوه استفاده از کلاس تاریخ جلالی

برای استفاده از کلاس تاریخ جلالی (شمسی) ابتدا آن را از این آدرس بارگذاری کنید، در داخل فایل فشرده شما، یک فایل به نام `jdatetime.class.php` وجود دارد. آن‌را در ساختار پوشه‌ای پروژه خود قرار داده و از طریق دستور `require_one` فراخوانی کنید:

``` php
require_once dirname(__FILE__) . '/jdatetime.class.php';
```

برای شروع استفاده از این کلاس، باید یک شی از کلاس `jDateTime` بسازید. برای اینکار در جایی از برنامه خود خطوط زیر را فراخوانی کنید:

``` php
$date = new jDateTime(); //Creates a new instance
```

با این‌کار شما به کلاس تاریخ جلالی از طریق شی `$date` دسترسی خواهید داشت. اما سازنده این کلاس سه پارامتر را به عنوان تنظیمات سیستم قبول می‌کند:

``` php
$date = new jDateTime(true, true, 'Asia/Tehran');
```

پارامتر اول، تعیین می‌کند که اعداد سیستم به فارسی تبدیل شوند یا نه. مثلا `1234` به ۱۲۳۴، این گزینه به صورت پیش‌فرض فعال است. برای غیر فعال کردن آن می‌توانید این پارامتر را به `false` تغییر دهید.
پارامتر دوم تبدیل تاریخ به جلالی را تعیین می‌کند و به صورت پیش‌فرض فعال است. در صورتی که می‌خواهید از این کلاس برای تاریخ میلادی استفاده کنید، این پارامتر را `false` تعیین کنید. توجه کنید که اگر این گزینه را غیرفعال کنید، دیگر اعداد به فارسی تبدیل نمی‌شوند حتی اگر آن را فعال کرده باشید.
پارامتر سوم، منطقه زمانی است. در سیستم های یونیکس مثل لینوکس و مکینتاش، منطقه زمانی پیش‌فرض `GMT` (ساعت گرینویچ) و در سیستم‌های ویندوز، منطقه زمانی پیشفرض، منطقه زمانی سیستم عامل انتخاب شده است. برای تعیین منطقه زمانی شما می‌توانید یکی از مناطق زمانی را که پی‌اچ‌پی قبول می‌کند به صورت متنی به کلاس ارسال کنید. برای مثال منطقه زمانی ایران `Iran/Tehran` و منطقه زمانی نیویورک `America/New_York` است. ([لیستی از مناطق زمانی معتبر](http://www.php.net/manual/en/timezones.php))

دقت کنید این پارامتر‌ها به عنوان پیشفرض‌های سیستم در نظر گرفته می‌شوند و در طول اجرای برنامه معتبرند.

### استفاده به صورت Static

با توجه به ماهیت برخی از پروژه‌ها، امکان ساخت شی جدید از روی کلاس (روشی که در بالا توضیح داده شد) وجود ندارد. برای همین شما می‌توانید کلاس jDateTime را به صورت static در کد خود به کار ببرید. برای این‌کار نیاز به ساخت شی جدید نیست و می‌توانید به صورت زیر از متدهای موجود در کلاس استفاده کنید:

``` php
echo jDateTime::date('l j F Y', false, false, true, 'Asia/Tehran');
```

### متد date

برای دریافت تاریخ می‌توانید از متد `date` در این کلاس به این صورت استفاده کنید:

``` php
$date = new jDateTime(true, true, 'Asia/Tehran');
echo $date->date("l j F Y H:i");
```

دو پارامتر اول متد `date` دقیقا مانند تابع `[date](http://php.net/date)` پی‌اچ‌پی است. پارامتر اول یک رشته قالب بندی، و پارامتر دوم زمان مورد نظر برای قالب‌بندی بر اساس ثانیه از اول ژانویه ۱۹۷۰ (مبنای تاریخ برنامه نویسی یا Epoch Time). در صورتی که می‌خواهید تاریخ را بر اساس زمان کنونی محاسبه کنید، می‌توانید متد `date` را بدون این پارامتر اجرا کنید و یا از تابع `[time()](http://php.net/time)` در پی‌اچ‌پی استفاده کنید.

توجه کنید در صورتی که هنگام ایجاد شی از روی کلاس پارامتر‌های ورودی را تنظیم کرده باشید (که در بالا توضیح داده شد)، متد `date` بر اساس آن‌ها عمل خواهد کرد. اما گاهی شما نیازدارید که به صورت موقت تنظیمات را تغییر دهید و نمیخواهید که این تنظیمات روی کل کلاس تاثیر داشته باشد. برای این منظورم، شما می‌توانید سه پارامتر دلخواه را به متد `date` ارسال کنید:

``` php
$date->date("d-m-Y", time(), false, true, 'America/New_York');
```

پارامتر سوم، چهارم و پنجم، دقیقا مثل پارامتر‌هایی که هنگام ساخت شی به کلاس ارسال کردید، عمل می‌کنند. پارامتر اول تبدیل اعداد، پارامتر دوم تاریخ جلالی و پارامتر سوم منطقه زمانی را تعیین می‌کنند. برای استفاده از مقادیر پیشفرض هرکدام از این پارامتر ها می‌توانید به آنها `null` ارسال کنید.
برای مثال اگر منطقه زمانی را `Asia/Tehran` انتخاب کرده‌اید ولی میخواهید یک رشته تاریخ را بر اساس منطقه زمانی نیویورک چاپ کنید، می‌توانید از دستور زیر استفاده کنید:

``` php
$date->date("d-m-Y", time(), null, null, 'America/New_York');
```

دستور بالا رشته قالب بندی شده بر اساس تنظیمات پیشفرض سیستم و منطقه زمانی نیویورک را برمی‌گرداند. در صورتی که دقیقا بعد از این دستور، مجددا متد `date` را اینبار بدون این پارامترها فراخوانی کنید، همه تنظیمات در حالت پیشفرض خواهند بود.

### متد gDate

همچنین برای هرچه ساده تر شدن این فرآیند، در صورتی که می‌خواهید از تاریخ میلادی استفاده کنید و به هر دلیلی نمی‌خواهید یا نمی‌توانید پارامتر های سوم و چهارم متد `date` را تنظیم نمایید، می‌توانید از متد کمکی `gDate` استفاده کنید. پارامتر اول و دوم این متد همانند متد `date` است و پارامتر سوم آن منطقه زمانی است (دلخواه). این متد همواره تاریخ را به میلادی باز می‌گرداند:

``` php
$date->gDate("Y-m-d", time(), 'Asia/Tehran');
```

### متد strftime

این متد مانند متد `date` تاریخ را به شکل دلخواه شما قالب بندی می‌کند، با این تفاوت که بجای حروف تعیین شده در دستور تابع [`date()`](http://us.php.net/date) پی‌اچ‌پی، همانند تابع `[strftime()](http://us.php.net/strftime)` کار می‌کند. آرگومان‌های ورودی این متد دقیقا مانند متد date می‌باشند. برای مشاهده لیست علائم پشتیبانی شده صفحه تابع `[strftime()](http://us.php.net/strftime)` در سایت پی‌اچ‌پی را ببینید. مثال:

``` php
$date->strftime("%x %H", time(), false, true, 'America/New_York');
```

### متد mktime

برای ساخت زمان بر اساس ثانیه می‌توانید از متد `mktime` استفاده کنید:

``` php
$time = $date->mktime(0,0,0,10,2,1368);
```

پارامتر‌های ورود این متد دقیقا همانند پارامتر‌های تابع `mktime()` در پی‌اچ‌پی هستند. به ترتیب: ساعت، دقیقه، ثانیه، ماه، روز، سال. خروجی این متد Unix Timestamp است که می‌توانید آن را در متد `date` استفاده کنید. برای مثال برای نمایش خروجی مثال بالا:

``` php
$time = $date->mktime(0,0,0,10,2,1368);
echo $date->date("l j F Y", $time); //خروجی‫:‬ شنبه ۲ دی ۱۳۶۸
```

متد `mktime` غیر از پارامتر‌های اصلی دو پارامتر اختیاری نیز دریافت می‌کند، پارامتر هفتم، که مشخص می‌کند تاریخ وارد شده در پارامترهای قبلی جلالی است یا خیر. به صورت پیش‌فرض این متد بر اساس تنظیمات اصلی کلاس عمل می‌کند. ولی گاهی وقتی تنظیمات اصلی جلالی است و شما می‌خواهید از همین متد برای تاریخ میلادی استفاده کنید، بدین منظور باید پارامتر هفتم را `false` ارسال نمایید:

``` php
$time = $date->mktime(0,0,0,12,23,2011, false);
```

برعکس این عمل نیز امکان پذیر است. برای مثال در تنظیمات اصلی کلاس پارامتر جلالی غیر فعال شده‌است، ولی شما می‌خواهید از متد `mktime` برای تاریخ جلالی استفاده کنید که در این حالت باید پارامتر هفتم `true` باشد.
پارامتر هشتم که کاملا دلخواه است پارامتر منطقه زمانی است. به صورت پیش‌فرض از تنظیمات اصلی کلاس استفاده می‌شود.

### متد checkdate

از این متد برای اعتبارسنجی تاریخ جلالی یا میلادی می‌توانید استفاده کنید. سه آرگومان اول این متد به ترتیب ماه، روز و سال به صورت عددی می‌باشند و آرگومان آخر نوع تاریخ (میلادی، یا جلالی) را تعیین می‌کند. اگر `true` را به عنوان ورودی چهارم ارسال کنید تاریخ جلالی، `false` تاریخ میلادی و در غیر اینصورت از تنظیمات اولیه کلاس که در بالا معرفی شد استفاده می‌شود. این متد صحت تاریخ ورودی را بررسی می‌کند. مثال:

``` php
$date->checkdate(10, 21, 1390); // Return true
$date->checkdate(9, 31, 1390); // Return false
```

## پورت‌ها و نسخه‌های دیگر

کلاس تاریخ جلالی به زبان‌ها و فریم‌وورک‌های دیگر نیز پورت شده‌است، لیستی از آن‌ها را در اینجا می‌بینید:

* [کلاس تاریخ جلالی برای فریم‌وورک Laravel (توسط سالار کابلی)](http://bundles.laravel.com/bundle/jdate)
* [کلاس تاریخ جلالی برای جاواسکریپت (Node.js) (توسط امیر محمودی)](https://github.com/Geeknux/node-jalali)

## دریافت کلاس تاریخ جلالی

این کد بر اساس [اجازه‌نامه MIT](http://opensource.org/licenses/mit-license.html) منتشر می‌شود.
کاربران اجازه دارند از این کد در پروژه‌های شخصی و تجاری بدون محدودیت استفاده کنند، به شرط اینکه نام برنامه نویس «سالار کابلی» و دیگر کپی‌رایت های موجود در کد را به صورت دست نخورده در سورس کد باقی بگذارند.

**توجه:** برای استفاده از این کد باید نسخه پی‌اچ‌پی نصب شده روی سرور شما ۵.۲ به بالا باشد.

سورس‌کد کلاس تاریخ/زمان جلالی (شمسی) را به صورت یک فایل فشرده [با پسوند tar.gz.](https://github.com/sallar/jDateTime/tarball/master) یا [با پسوند zip.](https://github.com/sallar/jDateTime/zipball/master) دریافت کنید.
کلاس تاریخ جلالی در GitHub منتشر میشود، می‌توانید در این پروژه کدباز مشارکت کنید. ([صفحه گیت هاب](http://github.com/sallar/jDateTime))

موفق باشید، سالار کابلی.
